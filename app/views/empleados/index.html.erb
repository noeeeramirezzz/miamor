<h1 class="mb-4 text-center">Empleados</h1>

<!-- Botón para crear nuevo -->
<div class="mb-3 d-flex justify-content-end">
  <%= link_to "Agregar Nuevo Empleado", new_empleado_path, class: "btn btn-success" %>
</div>

<!-- Contenedor principal -->
<div class="table-responsive">
  <%= form_with url: empleados_path, method: :get, local: true, class: "mb-3" do |f| %>
    <div class="input-group">
      <%= f.text_field :q, value: params[:q], class: "form-control", placeholder: "Buscar por nombre, cargo o email..." %>
      <button class="btn btn-primary">Buscar</button>
    </div>
  <% end %>

  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Cargo</th>
      <th>Teléfono</th>
      <th>Email</th>
      <th>Salario</th>
      <th>Fecha Contratación</th>
      <th>Creado</th>
      <th>Actualizado</th>
      <th>Activo</th>
      <th>Acciones</th>
    </tr>
    </thead>

    <tbody>
    <% @empleados.each_with_index do |empleado, index| %>
      <tr>
        <td><%= index + 1 %></td>
        <td><%= empleado.nombre %></td>
        <td><%= empleado.cargo&.nombre || '-' %></td>
        <td><%= empleado.telefono.presence || '-' %></td>
        <td><%= empleado.email.presence || '-' %></td>

        <td>
          <%= number_to_currency(
                empleado.salario,
                unit: "₲",
                precision: 0,
                delimiter: ".",
                format: "%u%n"
              ) %>
        </td>

        <td><%= empleado.fecha_contratacion&.strftime("%d/%m/%Y") %></td>
        <td><%= empleado.creado_en&.strftime("%d/%m/%Y") || '-' %></td>
        <td><%= empleado.actualizado_en&.strftime("%d/%m/%Y") || '-' %></td>

        <td>
          <% if empleado.activo %>
            <span class="badge bg-success">Sí</span>
          <% else %>
            <span class="badge bg-secondary">No</span>
          <% end %>
        </td>

        <td class="d-flex gap-1">
          <%= link_to edit_empleado_path(empleado),
                      class: "btn btn-sm btn-outline-primary",
                      title: "Editar empleado" do %>
            <i class="bi bi-pencil"></i>
          <% end %>

          <%= button_to empleado_path(empleado),
                        method: :delete,
                        data: { confirm: "¿Está seguro que desea eliminar este empleado?" },
                        class: "btn btn-sm btn-outline-danger",
                        title: "Eliminar empleado" do %>
            <i class="bi bi-trash"></i>
          <% end %>
        </td>
      </tr>
    <% end %>

    <% if @empleados.empty? %>
      <tr>
        <td colspan="11" class="text-center text-muted py-3">
          No hay empleados registrados.
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>

  <%= paginate @empleados %>
</div>
