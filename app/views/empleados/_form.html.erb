<%= form_with model: empleado, url: form_url, local: true do |form| %>

  <!-- FILA 1 -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <%= form.label :nombre, "Nombre Completo", class: "form-label" %>
      <%= form.text_field :nombre, class: "form-control", placeholder: "Ingrese el nombre del colaborador", required: true %>
    </div>

    <div class="col-md-6 mb-3">
      <%= form.label :cargo_id, "Puesto / Cargo", class: "form-label" %>
      <%= form.collection_select :cargo_id, Cargo.all, :id, :nombre,
                                 { prompt: "Seleccione un cargo" },
                                 { class: "form-select", id: "empleado_cargo_id" } %>
    </div>
  </div>

  <!-- FILA 2 -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <%= form.label :telefono, "Teléfono", class: "form-label" %>
      <%= form.text_field :telefono, class: "form-control", placeholder: "Ingrese el teléfono" %>
    </div>

    <div class="col-md-6 mb-3">
      <%= form.label :email, "Email", class: "form-label" %>
      <%= form.email_field :email, class: "form-control", placeholder: "Ingrese el correo electrónico" %>
    </div>
  </div>

  <!-- FILA 3 -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <%= form.label :salario, "Salario (₲)", class: "form-label" %>

      <!-- Campo visible -->
      <%= text_field_tag :salario_mostrado,
                         empleado.salario.present? ? number_to_currency(empleado.salario, unit: "₲", precision: 0) : "",
                         class: "form-control",
                         id: "salario_mostrado",
                         placeholder: "Se completa automáticamente",
                         readonly: true %>

      <!-- Campo oculto real -->
      <%= form.hidden_field :salario, id: "empleado_salario" %>
    </div>

    <div class="col-md-6 mb-3">
      <%= form.label :fecha_contratacion, "Fecha de Contratación", class: "form-label" %>
      <%= form.date_field :fecha_contratacion, class: "form-control" %>
    </div>
  </div>

  <!-- ACTIVO -->
  <div class="form-check mb-3">
    <%= form.check_box :activo, class: "form-check-input", id: "empleado_activo" %>
    <%= form.label :activo, "Empleado Activo", class: "form-check-label fw-semibold" %>
  </div>

  <!-- BOTONES -->
  <div class="mb-3">
    <%= form.submit "Guardar", class: "btn btn-primary" %>
    <%= link_to "Cancelar", empleados_path, class: "btn btn-secondary ms-2" %>
  </div>

<% end %>

<!-- ============================
       JAVASCRIPT DEL SALARIO
=============================== -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cargoSelect = document.getElementById("empleado_cargo_id");
        const salarioReal = document.getElementById("empleado_salario");
        const salarioMostrado = document.getElementById("salario_mostrado");

        if (!cargoSelect) return;

        cargoSelect.addEventListener("change", async () => {
            const cargoId = cargoSelect.value;

            if (!cargoId) {
                salarioReal.value = "";
                salarioMostrado.value = "";
                return;
            }

            try {
                const response = await fetch(`/cargos/${cargoId}.json`);
                const data = await response.json();
                const valor = Number(data.salario);

                salarioReal.value = valor;

                salarioMostrado.value = valor.toLocaleString("es-PY", {
                    style: "currency",
                    currency: "PYG",
                    minimumFractionDigits: 0
                });

            } catch (error) {
                console.error("Error cargando salario:", error);
            }
        });
    });
</script>
