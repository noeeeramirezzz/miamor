<h1>Asignaciones</h1>

<% if notice %>
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <%= notice %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>

<div class="d-flex justify-content-end mb-3">
  <%= link_to "Nueva Asignación", new_asignacione_path, class: "btn btn-success" %>
</div>

<div class="table-responsive">
  <%= form_with url: asignaciones_path, method: :get, local: true, class: "mb-3" do |f| %>
    <div class="input-group">
      <%= f.text_field :q, value: params[:q], class: "form-control", placeholder: "Buscar por evento, empleado o estado..." %>
      <button class="btn btn-primary">Buscar</button>
    </div>
  <% end %>

  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
    <tr>
      <th>#</th>
      <th>Evento</th>
      <th>Empleado</th>
      <th>Rol</th>
      <th>Tarea</th>
      <th>Estado</th>
      <th>Creado</th>
      <th>Actualizado</th>
      <th>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <% @asignaciones.each_with_index do |asignacion, index| %>
      <tr>
        <td><%= index + 1 %></td>
        <td><%= asignacion.evento&.nombre_evento || "Sin evento" %></td>
        <td><%= asignacion.empleado&.nombre || "Sin empleado" %></td>
        <td><%= asignacion.rol %></td>
        <td><%= asignacion.tarea %></td>
        <td><%= asignacion.estado %></td>
        <td><%= asignacion.created_at&.strftime("%d/%m/%Y") %></td>
        <td><%= asignacion.updated_at&.strftime("%d/%m/%Y") %></td>
        <td class="d-flex gap-1">
          <%= link_to edit_asignacione_path(asignacion), class: "btn btn-sm btn-outline-primary", title: "Editar" do %>
            <i class="bi bi-pencil"></i>
          <% end %>
          <%= button_to asignacione_path(asignacion), method: :delete, data: { confirm: "¿Está seguro?" }, class: "btn btn-sm btn-outline-danger", title: "Eliminar" do %>
            <i class="bi bi-trash"></i>
          <% end %>
        </td>
      </tr>
    <% end %>

    <% if @asignaciones.empty? %>
      <tr>
        <td colspan="9" class="text-center">No hay asignaciones registradas.</td>
      </tr>
    <% end %>
    </tbody>
  </table>
  <%= paginate @asignaciones %>

</div>
