<%= form_with model: contrato, url: form_url, local: true do |form| %>

  <div class="row">
    <div class="col-md-6 mb-3">
      <%= form.label :numero_contrato, "Número de Contrato", class: "form-label" %>
      <%= form.text_field :numero_contrato, class: "form-control", placeholder: "Ej: CN-2025-001" %>
    </div>

    <div class="col-md-6 mb-3">
      <%= form.label :evento_id, "Evento", class: "form-label" %>
      <%= form.collection_select :evento_id, Evento.all, :id, :nombre_evento,
                                 { prompt: "Seleccione un evento" }, class: "form-select" %>
    </div>
  </div>


  <div class="row">
    <div class="col-md-6 mb-3">
      <%= form.label :fecha_contrato, "Fecha del Contrato", class: "form-label" %>
      <%= form.datetime_local_field :fecha_contrato, class: "form-control" %>
    </div>

    <div class="col-md-6 mb-3">
      <%= form.label :monto_total, "Monto Total (₲)", class: "form-label" %>
      <%= form.number_field :monto_total, id: "contrato_monto_total",
                            class: "form-control", readonly: true %>
    </div>
  </div>


  <div class="mb-3">
    <%= form.label :estado, "Estado", class: "form-label" %>
    <%= form.select :estado, ["Activo", "Cancelado", "Finalizado"],
                    { prompt: "Seleccione un estado" }, class: "form-select" %>
  </div>


  <h4>Detalle del Contrato</h4>

  <table class="table table-bordered">
    <thead>
    <tr>
      <th>Servicio</th>
      <th>Cantidad</th>
      <th>Precio</th>
      <th>Subtotal</th>
      <th>Notas</th>
      <th></th>
    </tr>
    </thead>

    <tbody id="detalle-container">
    <%= form.fields_for :detalle_contratos do |detalle| %>
      <%= render "detalle_fields", f: detalle %>
    <% end %>
    </tbody>
  </table>

  <%= link_to "Agregar servicio", "#", id: "add-detalle", class: "btn btn-success" %>


  <!-- TEMPLATE CORREGIDO PARA CLONAR -->
  <script type="text/template" id="detalle_template">
    <%= form.fields_for :detalle_contratos, DetalleContrato.new, child_index: "NEW_RECORD" do |detalle| %>
      <%= render "detalle_fields", f: detalle %>
    <% end %>
  </script>


  <div class="mt-3">
    <%= form.submit "Guardar", class: "btn btn-primary" %>
    <%= link_to "Cancelar", contratos_path, class: "btn btn-secondary" %>
  </div>

<% end %>
